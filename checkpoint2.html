<!DOCTYPE html>
<html>
	<head>
		<!-- include dependencies -->
		<script type='text/javascript' src='lib/xapicollection.min.js'></script>
		<script type='text/javascript' src='lib/xapidashboard.min.js'></script>
		<script type='text/javascript' src='gen-lrs-data.js'></script>
		<link rel='stylesheet' href='lib/nv.d3.css'></script>
		
		<!-- include a basic style for laying out the graphs -->
		<style>
			h2 {
				text-align: center;
			}
			.container {
				display: flex;
				flex-direction: row;
				flex-wrap: wrap;
				justify-content: center;
				align-items: center;
			}
			.graph {
				width: 800px;
				height: 400px;
			}
		</style>
	</head>

	<body>
		<div class='container'>

			<!-- graph for the first question: mix, max, and average of tests -->
			<div class='graph' id='testScores'>
				<h2>Class Test Statistics</h2>
				<svg></svg>
			</div>

			<!-- graph for the second question: student count per letter grade -->
			<div class='graph' id='scoreBrackets'>
				<svg></svg>
			</div>

			<!-- graph for the third question: scores for individual students -->
			<div class='graph' id='studentScores'>
				<svg></svg>
			</div>

		</div>

		<!-- pushed to the end of body for quicker load times -->
		<script>

			
			var dash = new ADL.XAPIDashboard();

			// do this to fetch live data from an LRS
			/*ADL.XAPIWrapper.changeConfig({
				'endpoint': 'https://lrs.adlnet.gov/xAPI/'
			});
			dash.fetchAllStatements({}, function(){*/

			// do this to use the pre-loaded handwaved LRS data
			(function(cb){dash.addStatements(window.statements);cb();})(function(){

				var testScores = dash.createMultiBarChart({
					container: '#testScores.graph svg',
					pre: function(data){
						return data.where('result.score.raw != null').orderBy('object.id');
					},
					groupBy: 'object.id',
					aggregate: ADL.multiAggregate('result.score.raw', ADL.min, ADL.average, ADL.max),
					customize: function(nvd3chart){
						nvd3chart.xAxis.tickFormat(function(label){
							var a = /[^\/]*$/.exec(label)[0];
							return a;
						});
						nvd3chart.forceY([0,100]);
					}
				});

				testScores.draw();

			});



		</script>
	</body>
</html>
